<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Agent Prompt Builder - Build OpenClaw agent configurations in a guided workflow." />
    <title>Agent Prompt Builder</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body class="min-h-screen bg-slate-950 text-slate-100">
    <header class="border-b border-slate-800 bg-slate-900/80 backdrop-blur">
      <div class="mx-auto flex w-full max-w-7xl items-center justify-between px-4 py-4">
        <h1 class="text-xl font-semibold tracking-tight">Agent Prompt Builder</h1>
        <span class="rounded-full border border-slate-700 px-3 py-1 text-xs text-slate-300">Phase 2 Templates + Preview</span>
      </div>
    </header>

    <main class="mx-auto grid w-full max-w-7xl gap-6 px-4 py-8 lg:grid-cols-[280px_1fr]">
      <aside class="card p-4">
        <h2 class="mb-3 text-sm font-semibold uppercase tracking-wider text-slate-300">Wizard Steps</h2>
        <ol id="wizard-steps" class="space-y-2 text-sm text-slate-300"></ol>
      </aside>

      <section class="card p-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <h2 class="text-lg font-semibold">Agent Configuration</h2>
          <button id="btn-toggle-import" class="btn" type="button">Import existing agent</button>
        </div>

        <div id="import-panel" class="mt-4 hidden rounded-xl border border-slate-700 bg-slate-900/40 p-4">
          <h3 class="text-sm font-semibold uppercase tracking-wider text-slate-300">Import JSON or ZIP</h3>
          <p class="mt-2 text-xs text-slate-400">Drop a .json/.zip file here or tap to browse (mobile-friendly).</p>
          <div id="import-dropzone" class="import-dropzone mt-3" role="button" tabindex="0">
            <p class="text-sm text-slate-300">Drop file here or click to select</p>
            <p class="mt-1 text-xs text-slate-500">Supported: .json, .zip</p>
          </div>
          <input id="import-file-input" type="file" accept=".json,.zip,application/json,application/zip" class="hidden" />
          <p id="import-feedback" class="mt-3 hidden text-xs"></p>
        </div>

        <form id="agent-form" class="mt-5 space-y-5">
          <div class="wizard-panel" data-step="0">
            <h3 class="panel-title">Step 1 · Role & Persona</h3>
            <div class="field-grid">
              <label class="field">
                <span>Template</span>
                <select id="template-select" name="templateId"></select>
              </label>
              <label class="field">
                <span>Agent Name</span>
                <input type="text" name="name" placeholder="Orchestrator" />
              </label>
              <label class="field full">
                <span>Role</span>
                <input type="text" name="role" placeholder="You coordinate multiple agents and delegate tasks" />
              </label>
            </div>
          </div>

          <div class="wizard-panel hidden" data-step="1">
            <h3 class="panel-title">Step 2 · Constraints & Policies</h3>
            <div class="field-grid">
              <label class="field full">
                <span>Soul Prompt</span>
                <textarea name="soul" rows="4" placeholder="Core behavior and principles..."></textarea>
              </label>
              <label class="field full">
                <span>Identity Prompt</span>
                <textarea name="identity" rows="4" placeholder="Identity and scope..."></textarea>
              </label>
            </div>
          </div>

          <div class="wizard-panel hidden" data-step="2">
            <h3 class="panel-title">Step 3 · Tools & Permissions</h3>
            <div class="field-grid">
              <label class="field full">
                <span>Tools (comma separated)</span>
                <textarea name="tools" rows="3" placeholder="read, write, edit, exec"></textarea>
              </label>
              <label class="field">
                <span>Hierarchy</span>
                <select name="hierarchy">
                  <option value="Standalone">Standalone</option>
                  <option value="Manager">Manager</option>
                  <option value="Worker">Worker</option>
                </select>
              </label>
            </div>
          </div>

          <div class="wizard-panel hidden" data-step="3">
            <h3 class="panel-title">Step 4 · Memory & User Rules</h3>
            <div class="field-grid">
              <label class="field">
                <span>Memory Mode</span>
                <select name="memory">
                  <option value="Persistent">Persistent</option>
                  <option value="Session-only">Session-only</option>
                  <option value="Stateless">Stateless</option>
                </select>
              </label>
              <label class="field full">
                <span>Memory Notes</span>
                <textarea name="memoryNotes" rows="3" placeholder="Retention policy, key constraints..."></textarea>
              </label>
              <label class="field full">
                <span>User Guidelines</span>
                <textarea name="userGuidelines" rows="4" placeholder="How the agent should interact with users..."></textarea>
              </label>
            </div>
          </div>

          <div class="wizard-panel hidden" data-step="4">
            <h3 class="panel-title">Step 5 · Review & Generate</h3>
            <div id="validation-summary" class="mb-4"></div>
            <div class="field-grid">
              <label class="field full">
                <span>Agents (one per line)</span>
                <textarea name="agents" rows="4" placeholder="Developer\nResearcher"></textarea>
              </label>
            </div>

            <div class="mt-4">
              <h4 class="mb-2 text-sm font-semibold uppercase tracking-wider text-slate-300">Live Preview</h4>
              <div id="live-preview" class="preview-root"></div>
            </div>

            <div class="github-panel mt-5" id="github-export-panel">
              <div class="flex items-center justify-between gap-3">
                <h4 class="text-sm font-semibold uppercase tracking-wider text-slate-300">GitHub Export (v0.3)</h4>
                <span id="github-status" class="github-status disconnected">Not connected</span>
              </div>
              <p class="mt-2 text-xs text-amber-300">⚠️ This stores a GitHub token in your browser. Use with caution.</p>

              <div class="field-grid mt-3">
                <label class="field">
                  <span>GitHub OAuth Client ID</span>
                  <input id="github-client-id" type="text" placeholder="Iv1.xxxxxxxxxxxxxxxx" />
                </label>
                <label class="field remember-row">
                  <span>Token persistence</span>
                  <label class="inline-flex items-center gap-2 text-sm text-slate-300 pt-2">
                    <input id="github-remember" type="checkbox" />
                    Remember me (default off)
                  </label>
                </label>
              </div>

              <div class="mt-3 flex flex-wrap gap-2">
                <button id="btn-github-connect" class="btn" type="button">Connect to GitHub</button>
                <button id="btn-github-disconnect" class="btn" type="button">Disconnect</button>
                <button id="btn-github-refresh" class="btn" type="button">Refresh Repos</button>
                <button id="btn-github-retry" class="btn" type="button">Retry queued exports</button>
              </div>

              <div class="field-grid mt-4">
                <label class="field full">
                  <span>Search repos</span>
                  <input id="github-repo-search" type="text" placeholder="Search by name..." />
                </label>
                <label class="field">
                  <span>Repository</span>
                  <select id="github-repo-select">
                    <option value="">Select a repository</option>
                  </select>
                </label>
                <label class="field">
                  <span>Create new repo</span>
                  <div class="flex gap-2">
                    <input id="github-new-repo" type="text" placeholder="agent-prompts-test" />
                    <button id="btn-github-create-repo" class="btn" type="button">Create</button>
                  </div>
                </label>
                <label class="field">
                  <span>Source branch</span>
                  <select id="github-branch-select">
                    <option value="">Default branch</option>
                  </select>
                </label>
                <label class="field">
                  <span>New branch (optional)</span>
                  <input id="github-new-branch" type="text" placeholder="apb/export-2026-02-11" />
                </label>
                <label class="field full">
                  <span>Commit message</span>
                  <input id="github-commit-message" type="text" value="chore: export agent prompt pack" />
                </label>
                <label class="field full">
                  <span>Pull Request</span>
                  <label class="inline-flex items-center gap-2 text-sm text-slate-300">
                    <input id="github-open-pr" type="checkbox" checked />
                    Open PR after export
                  </label>
                </label>
              </div>
            </div>

            <div class="mt-6 rounded-xl border border-slate-700 bg-slate-900/40 p-4">
              <div class="flex flex-wrap items-center gap-2">
                <button id="compare-toggle" class="btn" type="button">Enable Compare Mode</button>
                <input id="version-name" class="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm" placeholder="v1 initial" />
                <button id="btn-save-version" class="btn" type="button">Save Version</button>
                <button id="btn-export-history" class="btn" type="button">Export Version History</button>
                <button id="btn-reset-prev" class="btn" type="button">Reset to Previous</button>
              </div>

              <div id="compare-panel" class="mt-4 hidden space-y-3">
                <div class="grid gap-3 md:grid-cols-2">
                  <label class="field"><span>Left (Original)</span><select id="compare-left"></select></label>
                  <label class="field"><span>Right (Modified)</span><select id="compare-right"></select></label>
                </div>
                <div class="flex flex-wrap gap-2">
                  <button id="btn-swap" class="btn" type="button">Swap Left/Right</button>
                  <button id="btn-compare-template" class="btn" type="button">Compare vs Template</button>
                  <button id="btn-compare-imported" class="btn" type="button">Compare vs Imported JSON</button>
                  <label class="inline-flex items-center gap-2 text-sm"><input id="chk-ignore-whitespace" type="checkbox" /> Ignore whitespace</label>
                  <label class="inline-flex items-center gap-2 text-sm"><input id="chk-only-changed" type="checkbox" /> Show changed files only</label>
                </div>
                <div class="flex flex-wrap gap-2">
                  <button id="btn-copy-right-left" class="btn" type="button">Copy all Right → Left</button>
                  <button id="btn-merge-selected" class="btn" type="button">Merge Selected Changes</button>
                  <button id="btn-export-patch" class="btn" type="button">Export Patch</button>
                  <button id="btn-export-changelog" class="btn" type="button">Export Changelog (.md)</button>
                </div>
                <div id="diff-container" class="diff-root"></div>
                <pre id="changelog-output" class="rounded-xl border border-slate-800 bg-slate-950 p-3 text-xs text-slate-200"></pre>
              </div>
            </div>
          </div>
        </form>

        <div class="mt-6 flex flex-wrap gap-3">
          <button id="btn-prev" class="btn" type="button">Previous</button>
          <button id="btn-next" class="btn btn-primary" type="button">Next</button>
          <button id="btn-generate" class="btn" type="button">Generate Config</button>
          <button id="btn-export" class="btn" type="button">Download ZIP</button>
          <button id="btn-export-github" class="btn btn-primary" type="button">Export to GitHub</button>
        </div>

        <pre id="output" class="mt-6 min-h-56 overflow-auto rounded-xl border border-slate-800 bg-slate-950 p-4 text-xs text-emerald-300"></pre>

        <div id="github-success-modal" class="modal hidden">
          <div class="modal-content">
            <h4 class="text-lg font-semibold">GitHub export successful</h4>
            <p id="github-success-text" class="mt-2 text-sm text-slate-300"></p>
            <div class="mt-4 flex gap-2">
              <a id="github-pr-link" class="btn btn-primary hidden" target="_blank" rel="noopener noreferrer">Open Pull Request</a>
              <button id="github-modal-close" class="btn" type="button">Close</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="border-t border-slate-800 py-4 text-center text-xs text-slate-400">
      Built with HTML/CSS/JS + Tailwind CDN. No backend.
    </footer>

    <!-- JSZip for ZIP export functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script src="./js/templates.js"></script>
    <script src="./js/storage.js"></script>
    <script src="./js/validation.js"></script>
    <script src="./js/wizard.js"></script>
    <script src="./js/import.js"></script>
    <script src="./js/preview.js"></script>
    <script src="./js/generator.js"></script>
    <script src="./js/versioning.js"></script>
    <script src="./js/github.js"></script>
    <script src="./js/exporter.js"></script>
    <script>
      window.AgentPromptBuilder?.boot?.();
    </script>
  </body>
</html>
